<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar</title>
    <link rel="stylesheet" href="sidebar.component.css">
</head>

<body>
  <span class="drawer__overlay" onclick="closeCart()"></span>
    <div class="drawer" id="mini-cart">  
      
      <div class="drawer__content">
        <form id="mini-cart-form" action="/cart" novalidate method="post">
          
          <div class="line-item" data-product-id="product-1">
            <!-- Phần 1: Hình ảnh sản phẩm -->
            <div class="line-item__content-wrapper">
                <a href="#" class="line-item__image-wrapper">
                    <img src="https://via.placeholder.com/100" alt="Product 1" class="line-item__image">
                </a>
            </div>
            <!-- Phần 2: Tên sản phẩm và nút điều chỉnh số lượng -->
            <div class="line-item__info">
              <p class="line-item__name">Product 1</p>
              <div class="quantity-selector">
                <button class="quantity-selector__button" type="button" onclick="changeQuantity('decrease', 'product-1')">-</button>
                <input type="text" class="quantity-selector__input" value="1" aria-label="Change quantity">
                <button class="quantity-selector__button" type="button" onclick="changeQuantity('increase', 'product-1')">+</button>
              </div>
          </div>
            <!-- Phần 3: Giá sản phẩm -->
            <div class="line-item__price-wrapper">
                <p class="line-item__price">$6,500</p>
            </div>
          </div>
        
          <div class="line-item" data-product-id="product-2">
            <!-- Phần 1: Hình ảnh sản phẩm -->
            <div class="line-item__content-wrapper">
                <a href="#" class="line-item__image-wrapper">
                    <img src="https://via.placeholder.com/100" alt="Product 2" class="line-item__image">
                </a>
            </div>
            <!-- Phần 2: Tên sản phẩm và nút điều chỉnh số lượng -->
            <div class="line-item__info">
              <p class="line-item__name">Product 2</p>
              <div class="quantity-selector">
                <button class="quantity-selector__button" type="button" onclick="changeQuantity('decrease', 'product-2')">-</button>
                <input type="text" class="quantity-selector__input" value="1" aria-label="Change quantity">
                <button class="quantity-selector__button" type="button" onclick="changeQuantity('increase', 'product-2')">+</button>
              </div>
          </div>
            <!-- Phần 3: Giá sản phẩm -->
            <div class="line-item__price-wrapper">
                <p class="line-item__price">$7,500</p>
            </div>
          </div>
        </form>
      </div>
      
      <footer class="mini-cart__footer">
        <div class="cart-total">
          <p><span id="total"></span></p>
        </div>
        <p class="shipping-info">Shipping & taxes calculated at checkout</p>
        <button type="submit" class="cart__checkout-button">COMPLETE YOUR ORDER</button>
      </footer>
    </div>
  <script>
    // Hàm để đóng giỏ hàng khi nhấn vào overlay
function closeCart() {
    const cartDrawer = document.getElementById('mini-cart');
    const overlay = document.querySelector('.drawer__overlay');
    
    // Thêm class để kích hoạt animation
    cartDrawer.classList.add('slide-out');

    // Sau khi animation kết thúc, ẩn giỏ hàng và overlay
    cartDrawer.addEventListener('animationend', function() {
        cartDrawer.classList.add('hidden'); // Ẩn giỏ hàng sau khi animation xong
        overlay.style.display = 'none'; // Ẩn overlay
    });
}
// Hàm mở giỏ hàng khi cần
function openCart() {
    const cartDrawer = document.getElementById('mini-cart');
    const overlay = document.querySelector('.drawer__overlay');

    // Hiển thị lại giỏ hàng và overlay
    cartDrawer.classList.remove('hidden');
    overlay.style.display = 'block';  // Hiển thị overlay
    cartDrawer.classList.remove('slide-out');  // Loại bỏ animation đóng
    cartDrawer.classList.add('slide-in');  // Thêm animation mở giỏ hàng
}

// Gọi openCart khi trang được tải
window.onload = function() {
    openCart();  // Mở giỏ hàng khi trang được tải
};

  // Hàm thay đổi số lượng sản phẩm khi nhấn các nút
    function changeQuantity(action, productId) {
      const inputField = document.querySelector(`[data-product-id='${productId}'] .quantity-selector__input`);
      let currentQuantity = parseInt(inputField.value);

      // Kiểm tra và thay đổi số lượng theo nút bấm
      if (action === 'increase') {
          currentQuantity++;
      } else if (action === 'decrease' && currentQuantity > 1) {
          currentQuantity--;
      } else if (action === 'decrease') {
          removeProduct(productId);  // Nếu số lượng = 1 và nhấn "-", xóa sản phẩm
          return;  // Dừng hàm nếu sản phẩm bị xóa
      }

      inputField.value = currentQuantity;
      updateTotal();  // Cập nhật tổng giỏ hàng khi số lượng thay đổi
  }

  function removeProduct(productId) {
      const product = document.querySelector(`[data-product-id='${productId}']`);
      if (product) {
          product.remove();
      }
      updateTotal();  // Cập nhật lại tổng giỏ hàng sau khi xóa sản phẩm
  }

  function updateTotal() {
      const productElements = document.querySelectorAll('.line-item');
      const totalElement = document.getElementById('total');
      let total = 0;

      productElements.forEach(product => {
          const quantity = parseInt(product.querySelector('.quantity-selector__input').value);
          const price = parseInt(product.querySelector('.line-item__price').innerText.replace('$', '').replace(',', ''));
          total += quantity * price;
      });

      if (productElements.length === 0) {
          totalElement.style.display = 'none';  // Ẩn total khi không có sản phẩm
      } else {
          totalElement.style.display = 'block';  // Hiển thị total khi có sản phẩm
          totalElement.innerText = total.toLocaleString();  // Cập nhật tổng giỏ hàng
      }
  }
// Nếu bạn muốn giỏ hàng tự động xuất hiện khi trang được tải
window.onload = function() {
    openCart();  // Mở giỏ hàng khi trang được tải
};
  window.onload = updateTotal;  // Gọi updateTotal khi trang được tải
  </script>  
</body>
</html>
