<body>
  <!-- Main Content -->
  <div class="main-content">
    <div class="order-detail-container">
      <!-- Header -->
      <div class="header">
        <h1>Chi tiết đơn hàng #{{ orderId }}</h1>
      </div>
      <div class="button-group">
        <button class="back-button" (click)="goBack()">
          <img src="assets/images/arrow-left.svg" alt="Back" />
          Quay lại
        </button>
      </div>

      <!-- Loading state -->
      <div *ngIf="loading" class="loading-state">Đang tải thông tin...</div>

      <!-- Error state -->
      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>

      <!-- Content -->
      <div *ngIf="!loading && !error" class="content-wrapper">
        <!-- Left Content (Order details) -->
        <div class="left-content">
          <div class="order-info-header">
            <div>
              <div class="info-label">Mã đơn hàng</div>
              <div class="info-value">{{ order?._id }}</div>
            </div>
            <div>
              <div class="info-label">Ngày đặt hàng</div>
              <div class="info-value">
                {{ formatDate(order?.OrderDate || "") }}
              </div>
            </div>
            <div>
              <div class="info-label">Phương thức thanh toán</div>
              <div class="info-value">{{ order?.PaymentMethod }}</div>
            </div>
            <div>
              <div class="info-label">Trạng thái</div>
              <div class="info-value">{{ order?.Status }}</div>
            </div>
          </div>

          <!-- Order Items Table -->
          <table class="order-table">
            <thead>
              <tr>
                <th>STT</th>
                <th>Sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of order?.OrderProduct; let i = index">
                <td>{{ i + 1 }}</td>
                <td>
                  <div class="product-info">
                    <img
                      *ngIf="hasProductImage(product._id)"
                      [src]="getProductImage(product._id)"
                      [alt]="products[product._id]?.Name"
                      class="product-image"
                    />
                    <span>{{
                      products[product._id]?.Name || "Đang tải..."
                    }}</span>
                  </div>
                </td>
                <td>{{ product.Quantity }}</td>
                <td>{{ formatCurrency(products[product._id]?.Price || 0) }}</td>
                <td>
                  {{
                    formatCurrency(
                      (products[product._id]?.Price || 0) * product.Quantity
                    )
                  }}
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Price Details -->
          <div class="price-details">
            <div class="price-row">
              <span>Tạm tính:</span>
              <span> {{ formatCurrency(order?.PrePrice || 0) }}</span>
            </div>
            <div class="price-row">
              <span>Phí vận chuyển:</span>
              <span> {{ formatCurrency(order?.DeliveryFee || 0) }}</span>
            </div>
            <hr />
            <div class="price-row total">
              <span>Tổng cộng:</span>
              <span> {{ formatCurrency(order?.TotalPrice || 0) }}</span>
            </div>
          </div>

          <!-- Status Buttons -->
          <div class="status-buttons">
            <button
              [class.active]="order?.Status === 'Cancelled'"
              (click)="updateOrderStatus('Cancelled')"
            >
              Hủy đơn
            </button>
            <button
              [class.active]="order?.Status === 'In transit'"
              (click)="updateOrderStatus('In transit')"
            >
              Đang giao
            </button>
            <button
              [class.active]="order?.Status === 'Delivered'"
              (click)="updateOrderStatus('Delivered')"
            >
              Đã giao
            </button>
            <button
              [class.active]="order?.Status === 'Completed'"
              (click)="updateOrderStatus('Completed')"
            >
              Hoàn thành
            </button>
          </div>
        </div>

        <!-- Right Content (Customer Information) -->
        <div class="right-content">
          <div class="info-container">
            <div class="customer-info">
              <h3>Thông tin khách hàng</h3>
              <hr />
              <div class="info-row">
                <span class="info-label">Tên:</span>
                <span class="info-value"> {{ customer?.Name || "N/A" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Địa chỉ:</span>
                <span class="info-value"> {{ order?.Address || "N/A" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Điện thoại:</span>
                <span class="info-value"> {{ order?.Phone || "N/A" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value"> {{ order?.Email || "N/A" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Giới tính:</span>
                <span class="info-value"> {{ customer?.Gender || "N/A" }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
